FROM dreamlabs/php-composer:latest

RUN apt-get update && \
    apt-get install -y yara php-ast && \
    git clone https://github.com/nbs-system/php-malware-finder.git /root/malfind && \
    sed -i "/\$pr\ = /c\$pr = \/(preg_replace(_callback)?|mb_ereg_replace|preg_filter)\\\s*\\\(.{,1000}(\\\/|\\\\\x2f)(e|\\\\\x65)['\"]\/" /root/malfind/php-malware-finder/php.yar && \
    ln -s /root/malfind/php-malware-finder/phpmalwarefinder /usr/bin/malfind;

CMD ["malfind"]
